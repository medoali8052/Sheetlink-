<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product details — Sheetlink</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <main class="max-w-4xl mx-auto p-6 mt-8">
    <a href="index.html" class="text-blue-600 mb-4 inline-block">← Back to products</a>
    <section id="details" class="bg-white rounded-3xl shadow p-6"></section>

    <h3 class="mt-8 text-xl font-semibold">Other products</h3>
    <div id="others" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mt-4"></div>
  </main>

<script>
  function getParam(name){ return new URLSearchParams(location.search).get(name); }

  async function load() {
    const id = getParam('id');
    const res = await fetch('products.json');
    const products = await res.json();
    const product = products.find(p => String(p.id) === String(id));
    const details = document.getElementById('details');

    if (!product) {
      details.innerHTML = '<p class="text-red-500">Product not found.</p>';
      return;
    }

    // embed youtube if link present (get video id)
    let youtubeEmbed = '';
    if (product.youtube) {
      // try extract id simple
      const ytMatch = product.youtube.match(/(?:v=|\/embed\/|\/watch\?v=|youtu\.be\/)([A-Za-z0-9_-]{6,})/);
      const vid = ytMatch ? ytMatch[1] : null;
      if (vid) {
        youtubeEmbed = `<div class="mb-6"><iframe width="100%" height="360" src="https://www.youtube.com/embed/${vid}" frameborder="0" allowfullscreen class="rounded-xl"></iframe></div>`;
      }
    }

    details.innerHTML = `
      <div class="grid gap-6 md:grid-cols-2">
        <div class="flex items-center justify-center bg-gray-100 rounded-xl overflow-hidden">
          <img src="${product.image}" alt="${escapeHtml(product.name)}" style="width:794px;height:794px;max-width:100%;max-height:100%;object-fit:cover;">
        </div>
        <div>
          <h1 class="text-2xl font-bold mb-2">${escapeHtml(product.name)}</h1>
          <p class="text-indigo-600 font-bold text-xl mb-4">${escapeHtml(product.price)}</p>
          <p class="text-gray-700 mb-4">${escapeHtml(product.description)}</p>
          <a href="${product.link || '#'}" target="_blank" class="inline-block bg-blue-600 text-white py-3 px-6 rounded-xl hover:bg-blue-700">Buy Now</a>
          ${youtubeEmbed}
        </div>
      </div>
    `;

    // other products
    const others = document.getElementById('others');
    others.innerHTML = products.filter(p => p.id !== product.id).map(p => `
      <article onclick="location.href='product.html?id=${p.id}'" class="bg-white rounded-xl p-3 shadow hover:shadow-lg cursor-pointer">
        <img src="${p.image}" alt="${escapeHtml(p.name)}" class="w-full h-48 object-cover rounded" />
        <h4 class="mt-2 font-medium">${escapeHtml(p.name)}</h4>
        <p class="text-indigo-600 font-bold">${escapeHtml(p.price)}</p>
      </article>
    `).join('');
  }

  function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  load();
</script>
</body>
</html>
